<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Derivadas paso a paso</title>

<!-- MathJax para f√≥rmulas -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- Plotly para gr√°ficas -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- math.js para c√°lculos simb√≥licos -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
input, button { padding: 8px; margin: 5px; }
.resultado { background: #f4f4f4; padding: 15px; border-radius: 8px; margin-top: 15px; }
</style>
</head>
<body>

<h1>üìò Derivada usando la f√≥rmula del l√≠mite</h1>
<p>Introduce la funci√≥n \(f(x)\) y pulsa <b>Calcular</b>:</p>
<input type="text" id="funcion" value="x^2 + 3*x + 2" size="30">
<button onclick="calcular()">Calcular derivada</button>

<div class="resultado" id="explicacion"></div>
<div id="grafica" style="width:100%;height:500px;"></div>

<script>
function calcular() {
    const funcionStr = document.getElementById("funcion").value;

    try {
        const mathScope = math.parser();
        mathScope.evaluate(`f(x) = ${funcionStr}`);

        let pasos = "";

        // Paso 1: F√≥rmula
        pasos += `<b>1Ô∏è‚É£ F√≥rmula general de la derivada:</b><br>`;
        pasos += `\\[
        f'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}
        \\]<br><br>`;

        // Paso 2: Sustituci√≥n
        const f_xh_str = funcionStr.replace(/x/g, "(x+h)");
        pasos += `<b>2Ô∏è‚É£ Sustituimos la funci√≥n:</b><br>`;
        pasos += `\\[
        f'(x) = \\lim_{h \\to 0} \\frac{${f_xh_str} - (${funcionStr})}{h}
        \\]<br><br>`;

        // Paso 3: Expandir y simplificar numerador
        const exprOriginal = math.parse(funcionStr);
        const exprXh = math.parse(funcionStr.replace(/x/g, "(x+h)"));
        const numerador = math.simplify(`(${exprXh}) - (${exprOriginal})`);
        pasos += `<b>3Ô∏è‚É£ Simplificamos el numerador:</b><br>`;
        pasos += `\\[
        ${numerador.toString()}
        \\]<br><br>`;

        // Paso 4: Dividir entre h
        const cociente = math.simplify(`(${numerador}) / h`);
        pasos += `<b>4Ô∏è‚É£ Dividimos todo entre h:</b><br>`;
        pasos += `\\[
        ${cociente.toString()}
        \\]<br><br>`;

        // Paso 5: L√≠mite cuando h -> 0
        const derivada = math.simplify(cociente.toString().replace(/h/g, "0"));
        pasos += `<b>5Ô∏è‚É£ Aplicamos el l√≠mite cuando h ‚Üí 0:</b><br>`;
        pasos += `\\[
        f'(x) = ${derivada.toString()}
        \\]<br><br>`;

        document.getElementById("explicacion").innerHTML = pasos;
        MathJax.typeset();

        // Gr√°fica de f(x) y f'(x)
        const f = (x) => mathScope.evaluate(`f(${x})`);
        const df = (x) => mathScope.evaluate(derivada.toString().replace(/x/g, `(${x})`));

        let xs = [], ys1 = [], ys2 = [];
        for (let xi = -10; xi <= 10; xi += 0.1) {
            xs.push(xi);
            ys1.push(f(xi));
            ys2.push(df(xi));
        }

        const trace1 = { x: xs, y: ys1, type: 'scatter', name: 'f(x)' };
        const trace2 = { x: xs, y: ys2, type: 'scatter', name: "f'(x)" };

        Plotly.newPlot('grafica', [trace1, trace2], {
            title: 'Funci√≥n y su derivada',
            xaxis: { title: 'x' },
            yaxis: { title: 'Valor' }
        });

    } catch (err) {
        document.getElementById("explicacion").innerHTML = `<b>Error:</b> Revisa la sintaxis de la funci√≥n.`;
    }
}
</script>

</body>
</html>
