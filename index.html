<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Derivadas paso a paso</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { text-align: center; }
        input, button { padding: 8px; margin: 5px; }
        .resultado { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>üìò Derivadas paso a paso</h1>
    <p>Introduce la funci√≥n \(f(x)\):</p>
    <input type="text" id="funcion" value="x^2" size="20">
    <button onclick="calcular()">Calcular derivada</button>

    <div class="resultado" id="explicacion"></div>
    <div id="grafica" style="width:100%;height:500px;"></div>

<script>
function calcular() {
    const math = window.math;
    const funcionStr = document.getElementById("funcion").value;

    try {
        // Usaremos math.js para c√°lculos simb√≥licos
        // Creamos expresi√≥n f(x)
        const parser = math.parser();
        parser.evaluate(`f(x) = ${funcionStr}`);

        // Simulaci√≥n paso a paso
        let pasos = "";
        pasos += `<b>1Ô∏è‚É£ F√≥rmula de la derivada:</b><br>`;
        pasos += `\\[
            f'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}
        \\]<br><br>`;

        pasos += `<b>2Ô∏è‚É£ Sustituimos f(x) = ${funcionStr}:</b><br>`;
        pasos += `\\[
            f'(x) = \\lim_{h \\to 0} \\frac{(${funcionStr.replace(/x/g,"(x+h)")}) - (${funcionStr})}{h}
        \\]<br><br>`;

        // Expandimos y simplificamos usando math.js
        const x = math.parse('x');
        const h = math.parse('h');
        const expr = math.parse(funcionStr);

        const fxh = expr.transform(function (node) {
            if (node.isSymbolNode && node.name === 'x') return math.parse('(x + h)');
            return node;
        });

        const numerador = math.simplify(math.parse(`(${fxh.toString()}) - (${expr.toString()})`));
        pasos += `<b>3Ô∏è‚É£ Simplificamos el numerador:</b><br>`;
        pasos += `\\[
            ${numerador.toString()}
        \\]<br><br>`;

        const cociente = math.simplify(`(${numerador.toString()}) / h`);
        pasos += `<b>4Ô∏è‚É£ Dividimos entre h:</b><br>`;
        pasos += `\\[
            ${cociente.toString()}
        \\]<br><br>`;

        const derivada = math.simplify(cociente.toString().replace(/h/g,"0")).toString();
        pasos += `<b>5Ô∏è‚É£ Tomamos el l√≠mite cuando h ‚Üí 0:</b><br>`;
        pasos += `\\[
            f'(x) = ${derivada}
        \\]<br>`;

        document.getElementById("explicacion").innerHTML = pasos;

        MathJax.typeset(); // Renderiza f√≥rmulas

        // Gr√°fica
        const f = (x) => parser.evaluate(`f(${x})`);
        const df = (x) => parser.evaluate(derivada.replace(/x/g, `(${x})`));

        let xs = [], ys1 = [], ys2 = [];
        for (let xi = -10; xi <= 10; xi += 0.1) {
            xs.push(xi);
            ys1.push(f(xi));
            ys2.push(df(xi));
        }

        const trace1 = { x: xs, y: ys1, type: 'scatter', name: 'f(x)' };
        const trace2 = { x: xs, y: ys2, type: 'scatter', name: "f'(x)" };

        Plotly.newPlot('grafica', [trace1, trace2], { title: 'Funci√≥n y su derivada' });

    } catch (error) {
        document.getElementById("explicacion").innerHTML = `<b>Error:</b> Verifica que la funci√≥n est√© bien escrita.`;
    }
}
</script>

<!-- Librer√≠a math.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
</body>
</html>
